# MetaDrive

MetaDrive is a Hardhat + React project that lets users upload files to IPFS and store references on an Ethereum-compatible chain. This repository contains the Solidity contract, Hardhat deployment scripts, and a Create React App frontend.

This README explains how to set up the project locally, deploy the contract to Sepolia, and deploy the frontend (for example, to Vercel). It also documents recommended production changes (server-side pinning) and common troubleshooting steps.

## Repo layout (important files)

- `contracts/Upload.sol` — Solidity contract for storing IPFS references.
- `scripts/deploy.js` — Hardhat deploy script that writes the deployed address to `client/src/contractAddress.js`.
- `hardhat.config.js` — Hardhat configuration; includes `sepolia` network (reads environment variables).
- `client/` — React frontend (Create React App).
  - `client/src/BackendComponents` — Wallet connect, upload and display components.
  - `client/src/abis` and `client/src/artifacts` — compiled contract ABI/artifacts (frontend imports ABI from here).
  - `client/src/contractAddress.js` — Generated by the deploy script (contains the deployed contract address). The frontend also supports `REACT_APP_CONTRACT_ADDRESS` as an override for production builds.

## Requirements

- Node.js (16+ recommended)
- npm (or yarn)
- A funded account / private key for deployment (Sepolia ETH)
- An Ethereum JSON-RPC endpoint for Sepolia (Infura / Alchemy / QuickNode / Public)
- (Optional) Pinning provider credentials if testing client-side pinning (Pinata) — note: DO NOT commit secrets to the repo. For production, prefer server-side pinning or web3.storage / nft.storage.

## Environment variables

Create a `.env` file in the project root (not committed). See `.env.example` for examples. The most important variables are:

- Root (used by Hardhat deploy):
  - `SEPOLIA_RPC_URL` — RPC URL for Sepolia (e.g. Alchemy/Infura)
  - `DEPLOYER_PRIVATE_KEY` — Private key used to sign the deploy transaction (0x-prefixed)

- Frontend (Create React App) — prefix with `REACT_APP_` if you need to expose values at build time:
  - `REACT_APP_CONTRACT_ADDRESS` — Optional: overrides `client/src/contractAddress.js` at build time.
  - `REACT_APP_SEPOLIA_RPC_URL` — Optional: used by the frontend to suggest adding Sepolia to MetaMask if needed.
  - `REACT_APP_PINATA_API_KEY` and `REACT_APP_PINATA_API_SECRET` — Only for quick tests. DO NOT use in production (secrets in client). Instead deploy a server-side upload endpoint.

## Quick start (development)

Open a terminal (PowerShell on Windows) and run the following commands from the repository root.

Install dependencies:

```powershell
cd e:/SEM5/PBL/MetaDrive
npm install
cd client
npm install
```

Compile contracts (Hardhat):

```powershell
cd e:/SEM5/PBL/MetaDrive
npx hardhat compile
```

Run the frontend (development mode):

```powershell
cd client
npm start
```

If you want to run a local Hardhat node for testing:

```powershell
npx hardhat node
# In another terminal (project root)
npx hardhat run scripts/deploy.js --network localhost
```

## Deploy to Sepolia (step-by-step)

1. Create a `.env` in the project root with the following keys (example):

```
SEPOLIA_RPC_URL=https://eth-sepolia.alchemyapi.io/v2/<your-key>
DEPLOYER_PRIVATE_KEY=0x<your-deployer-private-key>
```

2. Make sure the deployer account has Sepolia ETH for gas. You can use a Sepolia faucet.

3. Deploy the contract to Sepolia:

```powershell
cd e:/SEM5/PBL/MetaDrive
npx hardhat run scripts/deploy.js --network sepolia
```

The deploy script will print the deployed address and write/overwrite `client/src/contractAddress.js` with a default export containing the deployed address. Example content written by the script:

```js
export default "0xAbC123...";
```

4. Rebuild the frontend so it bundles the updated `contractAddress.js` (if you host a static site):

```powershell
cd client
npm run build
```

5. Deploy the `client/build` contents to your preferred hosting (Vercel, Netlify, S3+CloudFront, etc.).

Note: If you prefer to keep the contract address in CI/CD rather than committing `client/src/contractAddress.js`, set `REACT_APP_CONTRACT_ADDRESS` in the hosting environment variables and rebuild the app there.

## Vercel deployment notes

- Add the necessary environment variables in your Vercel project settings (Environment → Environment Variables):
  - `REACT_APP_CONTRACT_ADDRESS` (optional, overrides the local file)
  - Do NOT add Pinata secret keys to client-side env vars. Instead, create a Vercel Serverless Function (`api/upload.js`) that uses server-side environment variables to pin files to Pinata or other pinning providers.

- Build command: `npm run build` (default for CRA). Output directory: `client/build` (or set Vercel to the `client` project and build there).

## Pinning files and 429 rate-limit issues

Client-side pinning (i.e., calling Pinata from the browser) exposes API keys and is rate-limited. If you see HTTP 429 (Too Many Requests) when pinning files, follow one of these recommended production approaches:

1. Server-side pinning (recommended):
   - Create a serverless endpoint (Vercel, Netlify Functions, Heroku, etc.), e.g. `api/upload.js`.
   - The function accepts the file (multipart or base64), calls Pinata / web3.storage / nft.storage using server-side secrets, and returns the IPFS CID to the frontend.
   - Advantages: hides secrets, centralizes retries and backoff, avoids exposing keys to clients.

2. Switch to a different pinning provider like `web3.storage` or `nft.storage` which use an API token with free tiers and easier client workflows. They also provide built-in rate-limits and policies more suited for large public apps.

3. Implement retries with exponential backoff and honor `Retry-After` headers.

Example serverless outline (conceptual):

```js
// api/upload.js (Vercel)
// - receive file (multipart/base64)
// - call Pinata with server-side PINATA_API_KEY / PINATA_SECRET
// - return { cid: 'Qm...' }
```

Then call `/api/upload` from `client/src/BackendComponents/FileUpload.js` instead of calling Pinata directly.

## Common troubleshooting

- Hardhat "HH5: HardhatContext is not created" when requiring `hardhat.config.js` with plain Node: do not `require` Hardhat config using `node`; use Hardhat CLI commands like `npx hardhat compile` or `npx hardhat run` instead.

- React production build CSS minifier error: If you see an error like `Unexpected '/'` or CSS minifier errors, check for invalid CSS selectors such as `.image/video`. Use `.image video` instead.

- Wallet runtime error `unknown account #0 (operation='getAddress')`: Ensure you request account access before calling `signer.getAddress()`:

```js
await provider.send('eth_requestAccounts', []);
const signer = provider.getSigner();
const address = await signer.getAddress();
```

- Pinata `429 Too Many Requests`: move pinning server-side or switch provider; implement retries and backoff.

## Where to look in the code

- Wallet + upload logic: `client/src/BackendComponents/Backend.jsx` and `client/src/BackendComponents/FileUpload.js`
- Display logic: `client/src/BackendComponents/Display.js`
- Hardhat artifacts injected for frontend: `client/src/artifacts` and `client/src/abis`.

## Useful commands summary

```powershell
# Install
npm install
cd client; npm install

# Compile contracts
npx hardhat compile

# Local deploy to Hardhat node
npx hardhat node
npx hardhat run scripts/deploy.js --network localhost

# Deploy to Sepolia
npx hardhat run scripts/deploy.js --network sepolia

# Frontend (dev)
cd client
npm start

# Frontend (build)
cd client
npm run build
```

## Next steps / recommendations for production

- Implement a server-side upload endpoint to handle pinning. This prevents secret leakages and is more reliable for production.
- Add `deploy:sepolia` script to the root `package.json` to simplify deployments:

```json
"scripts": {
  "deploy:sepolia": "npx hardhat run scripts/deploy.js --network sepolia"
}
```

- Add a small `README-CONTRIBUTING.md` or extend this README with CI/CD instructions (how to set env vars in Vercel, Netlify, GitHub Actions, etc.).

## License

This project is provided as-is. Add a license file if you plan to share publicly.

---

If you want, I can now:

- Add a `deploy:sepolia` npm script to `package.json`.
- Add an example serverless `api/upload.js` function and update `FileUpload.js` to call it.
- Add a short `README` section that lists what env variables to set in Vercel and give step-by-step screenshots (text) for Vercel.

Tell me which of those you'd like next and I'll implement it.# Decentralized Image Upload and Sharing

This project facilitates decentralized image upload and sharing on the blockchain using Solidity for the smart contract and React for the front-end interface. It enables users to securely upload images to IPFS (InterPlanetary File System) and share access with specified users through smart contract functionality.

Here is the video in English - [Decentralize Google Drive](https://youtu.be/M-KRLlHG_zs?si=rD7I-fH-P8kGiwwf)

Here is the video in Hindi - [Decentralize Google Drive](https://youtu.be/fghqq3-P3x0?si=CVMpHFTW3-fa3R3A)

## Features

- **Decentralized Storage:** Images are uploaded to IPFS, ensuring decentralized and immutable storage.
- **Smart Contract:** Utilizes Solidity smart contracts on the Ethereum blockchain for access control and ownership management.
- **Access Control:** Users can grant or revoke access to their uploaded images to specific individuals through the smart contract.

## Technologies Used

- **Solidity:** Smart contract development for ownership and access control.
- **React:** Front-end interface for uploading images and managing access.
- **IPFS:** Decentralized storage protocol for hosting uploaded images.

## Usage

### Installation

1. Clone the repository:

   ```bash
   git clone https://github.com/your-username/decentralized-image-upload.git
   ```
2. Install dependencies for the hardhat:

   ```bash
   # Navigate to the root directory
   cd Dgdrive3.0
   # Install hardhat dependencies
   npm install
   ```
3. Compile the smart contract for artifacts:

   ```bash
   # Compile Smart Contract
   npx hardhat compile
   ```
4. Deploy the Solidity smart contract to an Ethereum testnet or local development environment.
   ```bash
   # Deploy Smart Contract
   npx hardhat run scripts/deploy.js --network <network-name>
   ```
5. Install dependencies for the React front end:
   ```bash
   # Navigate to the React client directory
   cd client 
   # Install React dependencies
   npm install
   ```
6. Run the react application:
   ```bash
   # Start React Application
   npm start
   ```
   
### Configuration

1. Set up environment variables:

   - Obtain API keys for Pinata to interact with IPFS.
   - Update the React component (FileUpload.js) with your Pinata API keys.
     
### Usage

Once the setup and configuration are complete, follow these steps to utilize the decentralized image upload and sharing system:

1. **Install Metamask:**
   - Ensure Metamask is installed and configured in your browser for Ethereum interactions.

2. **Update Contract Address:**
   - After smart contract deployment, make sure to update the contract address in `App.js` within the React application.

3. **Upload Image before "Get Data":**
   - Click "Get Data" only after uploading an image on Pinata. Otherwise, it will throw an error stating "You don't have access".

4. **Accessing Other User Images:**
   - Use the "Get Data" button to access other users' images. Input the user's address in the designated box, but remember, you can only access their images if they've granted you access through the smart contract. Otherwise, it will throw an error saying "You don't have access".

These steps will ensure smooth navigation and utilization of the system while maintaining access control and avoiding potential errors.

